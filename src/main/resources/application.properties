# --- CONFIGURACIÓN DE PUERTO (RAILWAY) ---
quarkus.http.port=${PORT:8080}

# --- BASE DE DATOS (MYSQL) ---
quarkus.datasource.db-kind=mysql
quarkus.datasource.username=${DB_USER}
quarkus.datasource.password=${DB_PASSWORD}
quarkus.datasource.jdbc.url=${DB_URL}

# Ajustes de conexión para evitar timeouts en la nube
quarkus.datasource.jdbc.acquisition-timeout=60S
quarkus.datasource.jdbc.min-size=1
quarkus.datasource.jdbc.max-size=10
quarkus.datasource.jdbc.background-validation-interval=30S

# Migraciones automáticas de base de datos
quarkus.flyway.migrate-at-start=true
quarkus.flyway.baseline-on-migrate=true
quarkus.flyway.connect-retries=3

# --- SEGURIDAD JWT (CRÍTICO PARA EL ERROR 401) ---
mp.jwt.verify.issuer=kbcollection

# 1. Configuración para VERIFICAR tokens entrantes (Lectura)
smallrye.jwt.verify.key=${JWT_SECRET}
smallrye.jwt.verify.algorithm=HS256

# 2. Configuración para GENERAR tokens nuevos (Escritura)
smallrye.jwt.sign.key=${JWT_SECRET}
smallrye.jwt.new-token.signature-algorithm=HS256

# Logs detallados de seguridad (opcional, ayuda a depurar)
quarkus.log.category."io.smallrye.jwt".level=INFO
quarkus.log.category."io.quarkus.smallrye.jwt".level=INFO

# --- CORS: CONFIGURACIÓN EXPLÍCITA ---
quarkus.http.cors.enabled=true

# 1. Orígenes permitidos (SIN barra al final)
quarkus.http.cors.origins=https://kb-frontend-eta.vercel.app,http://localhost:5173

# 2. Encabezados permitidos (AQUÍ ESTÁ LA CLAVE: Authorization debe estar explícito)
quarkus.http.cors.headers=Authorization,Content-Type,Accept,Origin,X-Requested-With,Access-Control-Allow-Origin

# 3. Métodos permitidos
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS,HEAD

# 4. Credenciales (Necesario para enviar headers seguros)
quarkus.http.cors.access-control-allow-credentials=true

# 5. Caché (Para evitar llamadas OPTIONS constantes)
quarkus.http.cors.access-control-max-age=24H

# --- EMAIL (SMTP GMAIL) ---
quarkus.mailer.from=${MAIL_USER}
quarkus.mailer.host=smtp.gmail.com
quarkus.mailer.port=587
quarkus.mailer.start-tls=REQUIRED
quarkus.mailer.username=${MAIL_USER}
quarkus.mailer.password=${MAIL_PASSWORD}
quarkus.mailer.mock=false
quarkus.mailer.trust-all=true

# --- CLOUDINARY (IMÁGENES) ---
cloudinary.cloud-name=${CLOUD_NAME}
cloudinary.api-key=${CLOUD_KEY}
cloudinary.api-secret=${CLOUD_SECRET}